-- liquibase formatted sql

-- changeset kpalis:1636693704132-1 context:general 
CREATE TABLE "public"."analysis" ("analysis_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT, "description" TEXT, "type_id" INTEGER NOT NULL, "program" TEXT, "programversion" TEXT, "algorithm" TEXT, "sourcename" TEXT, "sourceversion" TEXT, "sourceuri" TEXT, "reference_id" INTEGER, "parameters" JSONB, "timeexecuted" TIMESTAMP WITHOUT TIME ZONE, "status" INTEGER NOT NULL, CONSTRAINT "pk_analysis" PRIMARY KEY ("analysis_id"));
CREATE TYPE myrowtype AS (
	"23" text,
	"24" text,
	"25" text,
	"26" text,
	"27" text
);
-- changeset kpalis:1636693704132-2 context:general 
CREATE TABLE "public"."cv" ("cv_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "group" TEXT NOT NULL, "term" TEXT NOT NULL, "definition" TEXT NOT NULL, "rank" INTEGER DEFAULT 0 NOT NULL, CONSTRAINT "pk_cv" PRIMARY KEY ("cv_id"));
COMMENT ON COLUMN "public"."cv"."group" IS 'Groups terms together, ex. map_type, analysis_type';

-- changeset kpalis:1636693704132-3 context:general 
CREATE TABLE "public"."germplasm" ("germplasm_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT, "external_code" TEXT, "species_id" INTEGER, "type_id" INTEGER, "created_by" INTEGER, "created_date" date DEFAULT ('now'::text)::date, "modified_by" INTEGER, "modified_date" date DEFAULT ('now'::text)::date, "status" INTEGER NOT NULL, "code" TEXT DEFAULT '0', CONSTRAINT "pk_germplasm" PRIMARY KEY ("germplasm_id"));

-- changeset kpalis:1636693704132-4 context:general 
CREATE TABLE "public"."contact" ("contact_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "lastname" TEXT NOT NULL, "firstname" TEXT NOT NULL, "code" TEXT NOT NULL, "email" TEXT NOT NULL, "roles" INT4[], "created_by" INTEGER, "created_date" date DEFAULT ('now'::text)::date, "modified_by" INTEGER, "modified_date" date DEFAULT ('now'::text)::date, "organization_id" INTEGER, CONSTRAINT "pk_contact" PRIMARY KEY ("contact_id"));

-- changeset kpalis:1636693704132-5 context:general 
CREATE TABLE "public"."dataset" ("dataset_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "experiment_id" INTEGER NOT NULL, "callinganalysis_id" INTEGER NOT NULL, "analyses" INT4[], "data_table" TEXT, "data_file" TEXT, "quality_table" TEXT, "quality_file" TEXT, "scores" JSONB, "created_by" INTEGER, "created_date" date DEFAULT ('now'::text)::date, "modified_by" INTEGER, "modified_date" date DEFAULT ('now'::text)::date, "status" INTEGER, "type_id" INTEGER, "name" TEXT, CONSTRAINT "pk_dataset" PRIMARY KEY ("dataset_id"));

-- changeset kpalis:1636693704132-6 context:general 
CREATE TABLE "public"."dnasample" ("dnasample_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT NOT NULL, "code" TEXT, "platename" TEXT, "num" TEXT, "well_row" TEXT, "well_col" TEXT, "project_id" INTEGER NOT NULL, "germplasm_id" INTEGER NOT NULL, "created_by" INTEGER, "created_date" date DEFAULT ('now'::text)::date, "modified_by" INTEGER, "modified_date" date DEFAULT ('now'::text)::date, "status" INTEGER NOT NULL, CONSTRAINT "pk_dnasample" PRIMARY KEY ("dnasample_id"));

-- changeset kpalis:1636693704132-7 context:general 
CREATE TABLE "public"."experiment" ("experiment_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT NOT NULL, "code" TEXT NOT NULL, "project_id" INTEGER NOT NULL, "platform_id" INTEGER NOT NULL, "manifest_id" INTEGER, "data_file" TEXT, "created_by" INTEGER, "created_date" date DEFAULT ('now'::text)::date, "modified_by" INTEGER, "modified_date" date DEFAULT ('now'::text)::date, "status" INTEGER NOT NULL, CONSTRAINT "pk_experiment" PRIMARY KEY ("experiment_id"));

-- changeset kpalis:1636693704132-8 context:general 
CREATE TABLE "public"."manifest" ("manifest_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT NOT NULL, "code" TEXT NOT NULL, "file_path" TEXT, "created_by" INTEGER, "created_date" date DEFAULT ('now'::text)::date, "modified_by" INTEGER, "modified_date" date DEFAULT ('now'::text)::date, CONSTRAINT "pk_manifest" PRIMARY KEY ("manifest_id"));

-- changeset kpalis:1636693704132-9 context:general 
CREATE TABLE "public"."mapset" ("mapset_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT NOT NULL, "code" TEXT NOT NULL, "description" TEXT, "reference_id" INTEGER, "type_id" INTEGER NOT NULL, "created_by" INTEGER, "created_date" date DEFAULT ('now'::text)::date, "modified_by" INTEGER, "modified_date" date DEFAULT ('now'::text)::date, "status" INTEGER NOT NULL, CONSTRAINT "pk_map" PRIMARY KEY ("mapset_id"));

-- changeset kpalis:1636693704132-10 context:general 
CREATE TABLE "public"."organization" ("organization_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT NOT NULL, "address" TEXT, "website" TEXT, "created_by" INTEGER, "created_date" date DEFAULT ('now'::text)::date, "modified_by" INTEGER, "modified_date" date DEFAULT ('now'::text)::date, "status" INTEGER DEFAULT 1 NOT NULL, CONSTRAINT "organization_pkey" PRIMARY KEY ("organization_id"));

-- changeset kpalis:1636693704132-11 context:general 
CREATE TABLE "public"."platform" ("platform_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT NOT NULL, "code" TEXT NOT NULL, "vendor_id" INTEGER, "description" TEXT, "created_by" INTEGER, "created_date" date DEFAULT ('now'::text)::date, "modified_by" INTEGER, "modified_date" date DEFAULT ('now'::text)::date, "status" INTEGER NOT NULL, "type_id" INTEGER NOT NULL, CONSTRAINT "pk_platform" PRIMARY KEY ("platform_id"));

-- changeset kpalis:1636693704132-12 context:general 
CREATE TABLE "public"."project" ("project_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT NOT NULL, "code" TEXT, "description" TEXT, "pi_contact" INTEGER NOT NULL, "created_by" INTEGER, "created_date" date DEFAULT ('now'::text)::date, "modified_by" INTEGER, "modified_date" date DEFAULT ('now'::text)::date, "status" INTEGER NOT NULL, CONSTRAINT "pk_project" PRIMARY KEY ("project_id"));

-- changeset kpalis:1636693704132-13 context:general 
CREATE TABLE "public"."dataset_dnarun" ("dataset_dnarun_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "dataset_id" INTEGER NOT NULL, "dnarun_id" INTEGER NOT NULL, "dnarun_idx" INTEGER, CONSTRAINT "pk_dataset_dnarun" PRIMARY KEY ("dataset_dnarun_id"));

-- changeset kpalis:1636693704132-14 context:general 
CREATE TABLE "public"."dnarun" ("dnarun_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "experiment_id" INTEGER NOT NULL, "dnasample_id" INTEGER NOT NULL, "name" TEXT, "code" TEXT, CONSTRAINT "pk_dnarun" PRIMARY KEY ("dnarun_id"));

-- changeset kpalis:1636693704132-15 context:general 
CREATE TABLE "public"."dataset_marker" ("dataset_marker_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "dataset_id" INTEGER NOT NULL, "marker_id" INTEGER NOT NULL, "call_rate" FLOAT4, "maf" FLOAT4, "reproducibility" FLOAT4, "scores" JSONB, "marker_idx" INTEGER, CONSTRAINT "pk_dataset_marker" PRIMARY KEY ("dataset_marker_id"));

-- changeset kpalis:1636693704132-16 context:general 
CREATE TABLE "public"."marker" ("marker_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "platform_id" INTEGER NOT NULL, "variant_id" INTEGER, "name" TEXT NOT NULL, "code" TEXT, "ref" TEXT, "alts" TEXT[], "sequence" TEXT, "reference_id" INTEGER, "primers" JSONB, "strand_id" INTEGER, "status" INTEGER NOT NULL, "probsets" JSONB, CONSTRAINT "pk_marker" PRIMARY KEY ("marker_id"));

-- changeset kpalis:1636693704132-17 context:general 
CREATE TABLE "public"."display" ("display_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "table_name" TEXT NOT NULL, "column_name" TEXT, "display_name" TEXT, "created_by" INTEGER, "created_date" date, "modified_by" INTEGER, "modified_date" date, "rank" INTEGER, CONSTRAINT "pk_table_display" PRIMARY KEY ("display_id"));

-- changeset kpalis:1636693704132-18 context:general 
CREATE TABLE "public"."dnarun_prop" ("dnarun_prop_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "dnarun_id" INTEGER NOT NULL, "props" JSONB NOT NULL, CONSTRAINT "pk_dnarun_prop" PRIMARY KEY ("dnarun_prop_id"));

-- changeset kpalis:1636693704132-19 context:general 
CREATE TABLE "public"."dnasample_prop" ("dnasample_prop_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "dnasample_id" INTEGER NOT NULL, "props" JSONB, CONSTRAINT "pk_dnasample_prop" PRIMARY KEY ("dnasample_prop_id"));

-- changeset kpalis:1636693704132-20 context:general 
CREATE TABLE "public"."linkage_group" ("linkage_group_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR NOT NULL, "start" INTEGER DEFAULT 0 NOT NULL, "stop" INTEGER DEFAULT 0 NOT NULL, "map_id" INTEGER NOT NULL, CONSTRAINT "pk_linkage_group" PRIMARY KEY ("linkage_group_id"));
COMMENT ON TABLE "public"."linkage_group" IS 'This table will contain different linkage groups, ie. Chromosome 1, Chromosome 2, etc. along with their respective start and stop boundaries.';
COMMENT ON COLUMN "public"."linkage_group"."name" IS 'ex. Chromosome 1, Chromosome 2, ..., ChromosomeN, LG01, LG02, etc.';
COMMENT ON COLUMN "public"."linkage_group"."start" IS 'Start of the linkage group. 0-based, interbased coordinates.';
COMMENT ON COLUMN "public"."linkage_group"."stop" IS 'The maximum position in the linkage group, ex. 200, 200000000';
COMMENT ON COLUMN "public"."linkage_group"."map_id" IS 'Foreign key to the Map table. This defines which map the linkage group belongs to.';

-- changeset kpalis:1636693704132-21 context:general 
CREATE TABLE "public"."marker_linkage_group" ("marker_linkage_group_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "marker_id" INTEGER NOT NULL, "start" numeric(13, 3), "stop" numeric(13, 3), "linkage_group_id" INTEGER NOT NULL, CONSTRAINT "pk_marker_map" PRIMARY KEY ("marker_linkage_group_id"));

-- changeset kpalis:1636693704132-22 context:general 
CREATE TABLE "public"."reference" ("reference_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT NOT NULL, "version" TEXT NOT NULL, "link" TEXT, "file_path" TEXT, CONSTRAINT "pk_reference" PRIMARY KEY ("reference_id"));

-- changeset kpalis:1636693704132-23 context:general 
CREATE TABLE "public"."germplasm_prop" ("germplasm_prop_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "germplasm_id" INTEGER NOT NULL, "props" JSONB, CONSTRAINT "pk_germplasm_prop" PRIMARY KEY ("germplasm_prop_id"));

-- changeset kpalis:1636693704132-24 context:general 
CREATE TABLE "public"."role" ("role_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "role_name" TEXT NOT NULL, "role_code" TEXT NOT NULL, "read_tables" INT4[], "write_tables" INT4[], CONSTRAINT "pk_role" PRIMARY KEY ("role_id"));

-- changeset kpalis:1636693704132-25 context:general 
CREATE TABLE "public"."map_prop" ("map_prop_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "map_id" INTEGER NOT NULL, "props" JSONB, CONSTRAINT "pk_map_prop" PRIMARY KEY ("map_prop_id"));

-- changeset kpalis:1636693704132-26 context:general 
CREATE TABLE "public"."marker_prop" ("marker_prop_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "marker_id" INTEGER NOT NULL, "props" JSONB, CONSTRAINT "pk_marker_prop" PRIMARY KEY ("marker_prop_id"));

-- changeset kpalis:1636693704132-27 context:general 
CREATE TABLE "public"."platform_prop" ("platform_prop_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "platform_id" INTEGER NOT NULL, "props" JSONB, CONSTRAINT "pk_platform_prop" PRIMARY KEY ("platform_prop_id"));

-- changeset kpalis:1636693704132-28 context:general 
CREATE TABLE "public"."project_prop" ("project_prop_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "project_id" INTEGER NOT NULL, "props" JSONB, CONSTRAINT "pk_project_prop" PRIMARY KEY ("project_prop_id"));

-- changeset kpalis:1636693704132-29 context:general 
CREATE TABLE "public"."variant" ("variant_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "code" TEXT, "created_by" INTEGER, "created_date" date, "modified_by" INTEGER, "modified_date" date, CONSTRAINT "pk_variant" PRIMARY KEY ("variant_id"));

-- changeset kpalis:1636693704132-30 context:general 
CREATE TABLE "public"."marker_group" ("marker_group_id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" TEXT NOT NULL, "code" TEXT, "markers" JSONB NOT NULL, "germplasm_group" TEXT, "created_by" INTEGER, "created_date" date, "modified_by" INTEGER, "modified_date" date, "status" INTEGER NOT NULL, CONSTRAINT "pk_marker_group" PRIMARY KEY ("marker_group_id"));

-- changeset kpalis:1636693704132-31 context:general 
ALTER TABLE "public"."cv" ADD CONSTRAINT "group_term_key" UNIQUE ("group", "term");

-- changeset kpalis:1636693704132-32 context:general 
CREATE VIEW "public"."v_marker_metadata_by_dataset" AS SELECT m.marker_id,
    dm.dataset_id,
    p.name AS platform_name,
    m.variant_id,
    m.name,
    m.code,
    m.ref,
    m.alts,
    m.sequence,
    r.name AS reference_name,
    m.primers,
    m.probsets,
    cv.term AS strand_name,
    m.status
   FROM marker m,
    platform p,
    reference r,
    cv,
    dataset_marker dm
  WHERE ((m.marker_id = dm.marker_id) AND (m.platform_id = p.platform_id) AND (m.reference_id = r.reference_id) AND (m.strand_id = cv.cv_id));;

-- changeset kpalis:1636693704132-33 context:general 
ALTER TABLE "public"."germplasm" ADD CONSTRAINT "fk_germplasm_species_id_cv" FOREIGN KEY ("species_id") REFERENCES "public"."cv" ("cv_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-34 context:general 
ALTER TABLE "public"."germplasm" ADD CONSTRAINT "germplasm_germplasm_type_id_fkey" FOREIGN KEY ("type_id") REFERENCES "public"."cv" ("cv_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-35 context:general 
ALTER TABLE "public"."contact" ADD CONSTRAINT "email_key" UNIQUE ("email");

-- changeset kpalis:1636693704132-36 context:general 
CREATE VIEW "public"."v_all_projects_full_details" AS SELECT p.project_id,
    p.name,
    p.code,
    p.description,
    p.pi_contact AS pi_contact_id,
    c.firstname AS pi_first_name,
    c.lastname AS pi_last_name,
    p.created_by,
    p.created_date,
    p.modified_by,
    p.modified_date,
    p.status
   FROM (project p
     JOIN contact c ON ((p.pi_contact = c.contact_id)));;

-- changeset kpalis:1636693704132-37 context:general 
ALTER TABLE "public"."dataset" ADD CONSTRAINT "dataset_fk2" FOREIGN KEY ("callinganalysis_id") REFERENCES "public"."analysis" ("analysis_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-38 context:general 
ALTER TABLE "public"."dnasample" ADD CONSTRAINT "dnasample_fk2" FOREIGN KEY ("germplasm_id") REFERENCES "public"."germplasm" ("germplasm_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-39 context:general 
ALTER TABLE "public"."experiment" ADD CONSTRAINT "name_project_id_platform_id_key" UNIQUE ("name", "project_id", "platform_id");

-- changeset kpalis:1636693704132-40 context:general 
ALTER TABLE "public"."mapset" ADD CONSTRAINT "map_map_type_fkey" FOREIGN KEY ("type_id") REFERENCES "public"."cv" ("cv_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-41 context:general 
CREATE VIEW "public"."v_marker_linkage_genetic" AS SELECT mlg.marker_id,
    lg.name AS linkage_group_name,
    (mlg.start)::integer AS start,
    (mlg.stop)::integer AS stop,
    ms.name AS mapset_name
   FROM marker_linkage_group mlg,
    linkage_group lg,
    mapset ms
  WHERE ((mlg.linkage_group_id = lg.linkage_group_id) AND (lg.map_id = ms.mapset_id));;

-- changeset kpalis:1636693704132-42 context:general 
CREATE VIEW "public"."v_marker_linkage_physical" AS SELECT mlg.marker_id,
    lg.name AS linkage_group_name,
    mlg.start,
    mlg.stop,
    ms.name AS mapset_name
   FROM marker_linkage_group mlg,
    linkage_group lg,
    mapset ms
  WHERE ((mlg.linkage_group_id = lg.linkage_group_id) AND (lg.map_id = ms.mapset_id));;

-- changeset kpalis:1636693704132-43 context:general 
ALTER TABLE "public"."organization" ADD CONSTRAINT "organization_name_key" UNIQUE ("name");

-- changeset kpalis:1636693704132-44 context:general 
ALTER TABLE "public"."platform" ADD CONSTRAINT "fk_platform_contact" FOREIGN KEY ("vendor_id") REFERENCES "public"."contact" ("contact_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-45 context:general 
ALTER TABLE "public"."platform" ADD CONSTRAINT "fk_platform_cv" FOREIGN KEY ("type_id") REFERENCES "public"."cv" ("cv_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-46 context:general 
ALTER TABLE "public"."platform_prop" ADD CONSTRAINT "platform_prop_platform_id_fkey" FOREIGN KEY ("platform_id") REFERENCES "public"."platform" ("platform_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-47 context:general 
ALTER TABLE "public"."project" ADD CONSTRAINT "fk_project_contact" FOREIGN KEY ("pi_contact") REFERENCES "public"."contact" ("contact_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-48 context:general 
ALTER TABLE "public"."project" ADD CONSTRAINT "pi_project_name_key" UNIQUE ("pi_contact", "name");

-- changeset kpalis:1636693704132-49 context:general 
ALTER TABLE "public"."project_prop" ADD CONSTRAINT "project_prop_fk1" FOREIGN KEY ("project_id") REFERENCES "public"."project" ("project_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-50 context:general 
ALTER TABLE "public"."dataset_dnarun" ADD CONSTRAINT "dataset_dnarun_fk1" FOREIGN KEY ("dataset_id") REFERENCES "public"."dataset" ("dataset_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-51 context:general 
ALTER TABLE "public"."dnarun" ADD CONSTRAINT "dnarun_fk1" FOREIGN KEY ("experiment_id") REFERENCES "public"."experiment" ("experiment_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-52 context:general 
ALTER TABLE "public"."dnarun" ADD CONSTRAINT "dnarun_fk2" FOREIGN KEY ("dnasample_id") REFERENCES "public"."dnasample" ("dnasample_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-53 context:general 
ALTER TABLE "public"."dataset_marker" ADD CONSTRAINT "dataset_marker_dataset_id_fkey" FOREIGN KEY ("dataset_id") REFERENCES "public"."dataset" ("dataset_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-54 context:general 
ALTER TABLE "public"."marker" ADD CONSTRAINT "fk_marker_cv" FOREIGN KEY ("strand_id") REFERENCES "public"."cv" ("cv_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-55 context:general 
ALTER TABLE "public"."marker" ADD CONSTRAINT "marker_fk1" FOREIGN KEY ("platform_id") REFERENCES "public"."platform" ("platform_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-56 context:general 
CREATE VIEW "public"."v_marker_with_props" AS SELECT m.marker_id,
    m.name,
    mpr."23" AS genome_build,
    mpr."24" AS whatever,
    mp.props
   FROM marker m,
    marker_prop mp,
    LATERAL jsonb_populate_record(NULL::myrowtype, mp.props) mpr("23", "24", "25", "26", "27")
  WHERE (m.marker_id = mp.marker_id);;

-- changeset kpalis:1636693704132-57 context:general 
ALTER TABLE "public"."dnarun_prop" ADD CONSTRAINT "dnarun_prop_dnarun_id_fkey" FOREIGN KEY ("dnarun_id") REFERENCES "public"."dnarun" ("dnarun_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-58 context:general 
ALTER TABLE "public"."dnarun_prop" ADD CONSTRAINT "idx_dnarun_prop" UNIQUE ("dnarun_id");

-- changeset kpalis:1636693704132-59 context:general 
ALTER TABLE "public"."dnasample_prop" ADD CONSTRAINT "dnasample_prop_fk1" FOREIGN KEY ("dnasample_id") REFERENCES "public"."dnasample" ("dnasample_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-60 context:general 
ALTER TABLE "public"."dnasample_prop" ADD CONSTRAINT "idx_dnasample_prop" UNIQUE ("dnasample_id");

-- changeset kpalis:1636693704132-61 context:general 
ALTER TABLE "public"."linkage_group" ADD CONSTRAINT "fk_linkage_group_map" FOREIGN KEY ("map_id") REFERENCES "public"."mapset" ("mapset_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-62 context:general 
ALTER TABLE "public"."marker_linkage_group" ADD CONSTRAINT "fk_marker_linkage_group" FOREIGN KEY ("linkage_group_id") REFERENCES "public"."linkage_group" ("linkage_group_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-63 context:general 
ALTER TABLE "public"."marker_linkage_group" ADD CONSTRAINT "marker_map_marker_id_fkey" FOREIGN KEY ("marker_id") REFERENCES "public"."marker" ("marker_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-64 context:general 
ALTER TABLE "public"."germplasm_prop" ADD CONSTRAINT "germplasm_prop_fk1" FOREIGN KEY ("germplasm_id") REFERENCES "public"."germplasm" ("germplasm_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-65 context:general 
ALTER TABLE "public"."germplasm_prop" ADD CONSTRAINT "idx_germplasm_prop" UNIQUE ("germplasm_id");

-- changeset kpalis:1636693704132-66 context:general 
ALTER TABLE "public"."map_prop" ADD CONSTRAINT "idx_map_prop" UNIQUE ("map_id");

-- changeset kpalis:1636693704132-67 context:general 
ALTER TABLE "public"."map_prop" ADD CONSTRAINT "map_prop_map_id_fkey" FOREIGN KEY ("map_id") REFERENCES "public"."mapset" ("mapset_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-68 context:general 
ALTER TABLE "public"."marker_prop" ADD CONSTRAINT "idx_marker_prop" UNIQUE ("marker_id");

-- changeset kpalis:1636693704132-69 context:general 
ALTER TABLE "public"."marker_prop" ADD CONSTRAINT "marker_prop_marker_id_fkey" FOREIGN KEY ("marker_id") REFERENCES "public"."marker" ("marker_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-70 context:general 
ALTER TABLE "public"."platform_prop" ADD CONSTRAINT "idx_platform_prop" UNIQUE ("platform_id");

-- changeset kpalis:1636693704132-71 context:general 
ALTER TABLE "public"."project_prop" ADD CONSTRAINT "idx_project_prop" UNIQUE ("project_id");

-- changeset kpalis:1636693704132-72 context:general 
ALTER TABLE "public"."analysis" ADD CONSTRAINT "analysis_analysis_type_id_fkey" FOREIGN KEY ("type_id") REFERENCES "public"."cv" ("cv_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-73 context:general 
ALTER TABLE "public"."contact" ADD CONSTRAINT "fk_organization_contact" FOREIGN KEY ("organization_id") REFERENCES "public"."organization" ("organization_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-74 context:general 
ALTER TABLE "public"."dataset" ADD CONSTRAINT "dataset_fk1" FOREIGN KEY ("experiment_id") REFERENCES "public"."experiment" ("experiment_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-75 context:general 
ALTER TABLE "public"."dnasample" ADD CONSTRAINT "dnasample_fk1" FOREIGN KEY ("project_id") REFERENCES "public"."project" ("project_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-76 context:general 
ALTER TABLE "public"."experiment" ADD CONSTRAINT "experiment_fk1" FOREIGN KEY ("project_id") REFERENCES "public"."project" ("project_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-77 context:general 
ALTER TABLE "public"."experiment" ADD CONSTRAINT "experiment_fk2" FOREIGN KEY ("platform_id") REFERENCES "public"."platform" ("platform_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-78 context:general 
ALTER TABLE "public"."experiment" ADD CONSTRAINT "experiment_fk3" FOREIGN KEY ("manifest_id") REFERENCES "public"."manifest" ("manifest_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-79 context:general 
ALTER TABLE "public"."mapset" ADD CONSTRAINT "map_reference_id_fkey" FOREIGN KEY ("reference_id") REFERENCES "public"."reference" ("reference_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-80 context:general 
ALTER TABLE "public"."dataset_dnarun" ADD CONSTRAINT "dataset_dnarun_fk2" FOREIGN KEY ("dnarun_id") REFERENCES "public"."dnarun" ("dnarun_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-81 context:general 
ALTER TABLE "public"."dataset_marker" ADD CONSTRAINT "dataset_marker_marker_id_fkey" FOREIGN KEY ("marker_id") REFERENCES "public"."marker" ("marker_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-82 context:general 
ALTER TABLE "public"."marker" ADD CONSTRAINT "fk_marker_reference" FOREIGN KEY ("reference_id") REFERENCES "public"."reference" ("reference_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset kpalis:1636693704132-83 context:general 
ALTER TABLE "public"."marker" ADD CONSTRAINT "marker_fk2" FOREIGN KEY ("variant_id") REFERENCES "public"."variant" ("variant_id") ON UPDATE NO ACTION ON DELETE NO ACTION;
